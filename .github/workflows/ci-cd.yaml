# æ–‡ä»¶å: .github/workflows/ci-cd.yml

name: Vite React CI/CD Pipeline

# 1. è§¦å‘äº‹ä»¶
# åœ¨ä»£ç æ¨é€åˆ° main åˆ†æ”¯ æˆ– æäº¤é’ˆå¯¹ main åˆ†æ”¯çš„ Pull Request æ—¶è¿è¡Œ
on:
  push:
    branches: ['master']
  pull_request:
    branches: ['master']

# æƒé™é…ç½®ï¼šéƒ¨ç½²åˆ° Pages éœ€è¦æ­¤æƒé™
permissions:
  contents: read
  pages: write
  id-token: write

# 2. å®šä¹‰ä»»åŠ¡
jobs:
  # ======== ä»»åŠ¡ 1: æŒç»­é›†æˆ (Build & Lint) ========
  ci:
    name: Build and Lint Check
    runs-on: ubuntu-latest

    steps:
      # A. æ£€å‡ºä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4

      # B. è®¾ç½® Node.js ç¯å¢ƒ (ä½¿ç”¨ LTS 20 ç‰ˆæœ¬)
      - name: Set up Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: 20
          # å¯ç”¨ç¼“å­˜ä»¥åŠ é€Ÿå®‰è£… (æ ¹æ® lock æ–‡ä»¶)
          cache: 'npm'

      # C. å®‰è£…ä¾èµ– (ä½¿ç”¨ npm ci - æœ€ä½³å®è·µ)
      - name: Install dependencies
        run: npm ci

      # D. è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥ (Linter)
      # æ ¹æ®æ‚¨çš„ package.jsonï¼Œè¿è¡Œ lint å‘½ä»¤
      - name: Run ESLint
        run: npm run lint

      # E. æ„å»ºé¡¹ç›® (Vite Build)
      # è¿™ä¸€æ­¥éªŒè¯æ‰€æœ‰ä»£ç å’Œ TypeScript ç±»å‹æ— è¯¯
      - name: Build production bundle
        run: npm run build

      # F. å‡†å¤‡ Pages éƒ¨ç½²
      # è¿™ä¸€æ­¥æ˜¯ä¸ºäº†åç»­éƒ¨ç½²åˆ° GitHub Pages åšå‡†å¤‡
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # G. ä¸Šä¼ æ„å»ºäº§ç‰© (Artifact)
      # å°† Vite ç”Ÿæˆçš„ ./dist ç›®å½•ä½œä¸º artifact ä¸Šä¼ ï¼Œä¾›éƒ¨ç½²ä»»åŠ¡ä½¿ç”¨
      - name: Upload production artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Vite é»˜è®¤è¾“å‡ºç›®å½•
          path: './dist'

  # ======== ä»»åŠ¡ 2: æŒç»­éƒ¨ç½² (Deploy to GitHub Pages) ========
  deploy:
    name: Deploy to GitHub Pages
    # å¿…é¡»ç­‰å¾… ci ä»»åŠ¡æˆåŠŸå®Œæˆåæ‰è¿è¡Œ
    needs: ci
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
### ğŸš€ é¢å¤–æ­¥éª¤ï¼šå¯ç”¨ GitHub Pages

